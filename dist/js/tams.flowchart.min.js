$.fn.flowchart=function(t){null==t&&(t={});var e=$(this);void 0!==t.nodeSize?e.css("--size",t.nodeSize):e[0].hasAttribute("data-node-size")&&(t.nodeSize=e.attr("data-node-size"),e.css("--size",t.nodeSize)),void 0!==t.lineSize||(e[0].hasAttribute("data-line-size")?t.lineSize=e.attr("data-line-size"):t.lineSize=3),void 0!==t.results&&null!==t.results?t.hasResults=!0:t.hasResults=!1;var i=e.find("canvas");i=0===i.length?e[0].appendChild(document.createElement("canvas")):i[0],i.width=e[0].clientWidth,i.height=e[0].clientHeight;for(var s=i.getContext("2d"),n=function(i,s){return this.FlowChart=i.FlowChart,this.Expression=i,this.Element=s,this.Id=this.Element.hasAttribute("id")?this.Element.getAttribute("id"):"",this.PassNames=this.Element.hasAttribute("data-pass")?this.Element.getAttribute("data-pass").split(","):"",this.FailName=this.Element.hasAttribute("data-fail")?this.Element.getAttribute("data-fail"):"",this.Dependency="",this.Element.hasAttribute("data-parent")&&(this.Dependency=this.Element.getAttribute("data-parent"),"none"===$(this.Dependency)[0].style.display?this.Element.style.display="none":this.Element.style.display="table-cell"),this.Element.getXY=function(){var t=$(this).closest(".flowchart")[0].getBoundingClientRect(),e=this.getBoundingClientRect(),i={x:0,y:0};return i.x=e.left-t.left+e.width/2,i.y=e.top-t.top+e.height/2,i}.bind(this.Element),$(this.Element).off("input"),$(this.Element).on("input",function(){e.flowchart()}),this.Draw=function(e){if("none"!==this.Element.style.display){var i=this.Element.getXY();e.lineWidth=t.lineSize;var s=function(t,i){e.moveTo(t.x,t.y);var s=t.y+(i.y-t.y)/2;e.lineTo(t.x,s),e.lineTo(i.x,s),e.lineTo(i.x,i.y),e.stroke()},n=function(t,n){null==n&&(n="#262626");var l=r(t);if(null!=l&&void 0!==l.Element&&null!=l.Element&&"none"!=l.Element.style.display){var h=l.Element.getXY();return e.beginPath(),e.strokeStyle=n,s(i,h),!0}return""!==t&&console.log("Can't find '"+t+"'"),!1};if(t.hasResults&&t.results["#"+this.Id]||!t.hasResults)for(var l=this.PassNames.length,h=0;h<l;h++)n(this.PassNames[h],"#089342");(t.hasResults&&!t.results["#"+this.Id]||!t.hasResults)&&n(this.FailName,"#a90329")}}.bind(this),this},l=function(t){this.FlowChart=e,this.Element=t,this.Items=new Array;for(var i=$(t).find(".logic"),s=i.length,l=0;l<s;l++)this.Items.push(new n(this,i[l]));return this.has=function(t){return null!==this.get(t)}.bind(this),this.get=function(t){if(null==t||""===t)return null;for(var e=this.Items.length,i=0;i<e;i++)if("#"+this.Items[i].Id.toLowerCase()===t.toLowerCase())return this.Items[i];return null}.bind(this),this.Draw=function(t){for(var e=this.Items.length,i=0;i<e;i++)this.Items[i].Draw(t)}.bind(this),this},h=e.find(".expression"),a=new Array,r=function(t){for(var e=this.length,i=0;i<e;i++)if(this[i].has(t))return this[i].get(t)}.bind(a),o=h.length,u=0;u<o;u++)a.push(new l(h[u]));console.log("Expressions: ",a);for(o=a.length,u=0;u<o;u++)a[u].Draw(s);return e.data=t,e.showPath=function(t){}.bind(e),e};